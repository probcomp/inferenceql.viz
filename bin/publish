#!/bin/sh

usage() {
    echo "Usage: ${0} spreadsheet-dir surge-domain"
}

if [ $# -eq 0 ]; then
    usage
    exit 1
fi

# Thanks chepner for the solution that doesn't rely on `[[`
# https://stackoverflow.com/a/20204890
case $1 in
  /*)
    ;;
  *)
    usage
    echo
    echo "spreadsheet-dir must be an absolute path."
    exit 1
    ;;
esac

readonly DIR="$1/.publish"

rm -rf "$DIR"
mkdir "$DIR"
echo "!node_modules" > "$DIR/.surgeignore"
cp "$1/index.html" "$DIR"
# Copy the AUTH file if it exists.
[[ -e "$1/AUTH"]] && cp "$1/AUTH" "$DIR"
cp -r "$1/out" "$DIR"
cp -r "$1/resources" "$DIR"
cd "$DIR" ; surge --domain $2
rm -rf "$DIR"
